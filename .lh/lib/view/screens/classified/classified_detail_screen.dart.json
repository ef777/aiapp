{
    "sourceFile": "lib/view/screens/classified/classified_detail_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1667569426695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1667569426695,
            "name": "Commit-0",
            "content": "import 'dart:io';\r\nimport 'dart:ui';\r\n\r\nimport 'package:ainsighter/data/model/response/classified_model.dart';\r\nimport 'package:ainsighter/provider/auth_provider.dart';\r\nimport 'package:ainsighter/provider/classified_provider.dart';\r\nimport 'package:ainsighter/provider/profile_provider.dart';\r\nimport 'package:ainsighter/utill/app_constants.dart';\r\nimport 'package:ainsighter/utill/config.dart';\r\nimport 'package:ainsighter/view/base/lazy_image.dart';\r\nimport 'package:ainsighter/view/screens/auth/login_screen.dart';\r\nimport 'package:ainsighter/view/screens/classified/create_classified_screen.dart';\r\nimport 'package:carousel_slider/carousel_slider.dart';\r\nimport 'package:flutter/material.dart';\r\nimport 'package:flutter_share/flutter_share.dart';\r\nimport 'package:font_awesome_flutter/font_awesome_flutter.dart';\r\nimport 'package:full_screen_image/full_screen_image.dart';\r\nimport 'package:intl/intl.dart';\r\nimport 'package:provider/provider.dart';\r\nimport 'package:sliding_sheet/sliding_sheet.dart';\r\nimport 'package:url_launcher/url_launcher.dart';\r\nimport 'package:flutter/services.dart';\r\n\r\nimport '../../../provider/splash_provider.dart';\r\n\r\nfinal List<String> imgList = [\r\n  'https://i0.shbdn.com/photos/29/84/05/x5_1044298405la5.jpg',\r\n  'https://i0.shbdn.com/photos/29/84/05/x5_1044298405vtz.jpg',\r\n  'https://i0.shbdn.com/photos/29/84/05/x5_1044298405la5.jpg',\r\n  'https://i0.shbdn.com/photos/29/84/05/x5_1044298405vtz.jpg',\r\n];\r\n\r\nclass ClassifiedDetailScreen extends StatefulWidget {\r\n  ClassifiedDetailScreen({this.classifield});\r\n\r\n  final ClassifiedModel classifield;\r\n\r\n  @override\r\n  _ClassifiedDetailScreenState createState() => _ClassifiedDetailScreenState();\r\n}\r\n\r\nclass _ClassifiedDetailScreenState extends State<ClassifiedDetailScreen> {\r\n  SheetController _controller = new SheetController();\r\n\r\n  NumberFormat formatter = NumberFormat.decimalPattern('tr');\r\n\r\n  List usageStatus = [\r\n    {'value': 1, 'title': 'Yeni'},\r\n    {'value': 2, 'title': 'Yeni Gibi'},\r\n    {'value': 3, 'title': 'İyi'},\r\n    {'value': 4, 'title': 'Makul'},\r\n    {'value': 5, 'title': 'Yıpranmış'},\r\n  ];\r\n\r\n  List landStatus = [\r\n    {'value': 1, 'title': 'Hisseli Tapu'},\r\n    {'value': 2, 'title': 'Müstakil Parsel'},\r\n    {'value': 3, 'title': 'Tahsis'},\r\n    {'value': 4, 'title': 'Zilliyet'}\r\n  ];\r\n\r\n  bool isFaved = false;\r\n\r\n  @override\r\n  void initState() {\r\n    Future.microtask(() async {\r\n      if (Provider.of<AuthProvider>(context, listen: false).isLoggedIn()) {\r\n        ClassifiedModel clsf =\r\n            await Provider.of<ClassifiedProvider>(context, listen: false)\r\n                .getClassifiedById(context, widget.classifield.id);\r\n\r\n        try {\r\n          setState(() {\r\n            isFaved = clsf.isFaved;\r\n          });\r\n        } catch (e) {\r\n          print(e.toString());\r\n        }\r\n      }\r\n    });\r\n    super.initState();\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return SafeArea(\r\n      child: Scaffold(\r\n          body: SlidingSheet(\r\n        listener: (SheetState state) {\r\n          if (state.isExpanded) {\r\n            setState(() {});\r\n          } else {\r\n            setState(() {});\r\n          }\r\n        },\r\n        snapSpec: SnapSpec(snappings: [0.6, 1.0]),\r\n        minHeight: MediaQuery.of(context).size.height,\r\n        cornerRadius: 0,\r\n        cornerRadiusOnFullscreen: 0,\r\n        controller: _controller,\r\n        body: SafeArea(\r\n          child: Stack(\r\n            children: [\r\n              CarouselSlider(\r\n                options: CarouselOptions(\r\n                  height: MediaQuery.of(context).size.height * 0.4,\r\n                  viewportFraction: 0.9,\r\n                  autoPlay: true,\r\n                  autoPlayAnimationDuration: Duration(milliseconds: 2000),\r\n                  enlargeCenterPage: false,\r\n                ),\r\n                items: widget.classifield.images\r\n                    .map((item) => Container(\r\n                          margin: EdgeInsets.symmetric(horizontal: 4),\r\n                          child: Center(\r\n                              child: FullScreenWidget(\r\n                                  child: LazyImage(\r\n                            height: MediaQuery.of(context).size.height,\r\n                            fit: BoxFit.contain,\r\n                            url:\r\n                                '${AppConstants.BASE_URL}/storage/app/public/classifieds/${item}',\r\n                          ))),\r\n                        ))\r\n                    .toList(),\r\n              ),\r\n              Positioned(\r\n                  child: Padding(\r\n                      padding:\r\n                          EdgeInsets.symmetric(horizontal: 30, vertical: 30),\r\n                      child: Container(\r\n                        height: 40,\r\n                        width: 40,\r\n                        decoration: BoxDecoration(\r\n                            shape: BoxShape.circle,\r\n                            color: Colors.black.withOpacity(.5)),\r\n                        child: IconButton(\r\n                            icon: Icon(\r\n                              Icons.arrow_back,\r\n                            ),\r\n                            color: Colors.white,\r\n                            onPressed: () {\r\n                              Navigator.of(context).pop();\r\n                            }),\r\n                      )))\r\n            ],\r\n          ),\r\n        ),\r\n        builder: (context, state) {\r\n          return Padding(\r\n            padding: const EdgeInsets.symmetric(horizontal: 15.0),\r\n            child: Column(\r\n              children: [\r\n                Container(\r\n                  margin: EdgeInsets.only(right: 16),\r\n                  child: IconButton(\r\n                      icon: Icon(\r\n                        state.isExpanded\r\n                            ? Icons.keyboard_arrow_down\r\n                            : Icons.keyboard_arrow_up,\r\n                        size: 50,\r\n                      ),\r\n                      color: Colors.black38,\r\n                      onPressed: () {\r\n                        state.isExpanded\r\n                            ? _controller.collapse()\r\n                            : _controller.expand();\r\n                      }),\r\n                ),\r\n                SizedBox(\r\n                  height: 6,\r\n                ),\r\n                Text(\r\n                  widget.classifield.title,\r\n                  style: TextStyle(\r\n                      fontWeight: FontWeight.w500,\r\n                      color: Colors.grey.shade800,\r\n                      fontSize: 18,\r\n                      height: 1.4),\r\n                  textAlign: TextAlign.center,\r\n                ),\r\n                SizedBox(\r\n                  height: 20,\r\n                ),\r\n                IntrinsicHeight(\r\n                  child: Row(\r\n                    mainAxisAlignment: MainAxisAlignment.spaceBetween,\r\n                    children: [\r\n                      Expanded(\r\n                        flex: 3,\r\n                        child: Container(\r\n                          padding:\r\n                              EdgeInsets.symmetric(horizontal: 10, vertical: 5),\r\n                          decoration: BoxDecoration(\r\n                              color: Colors.blueGrey.withOpacity(.1),\r\n                              borderRadius: BorderRadius.circular(5)),\r\n                          child: Column(\r\n                            crossAxisAlignment: CrossAxisAlignment.center,\r\n                            mainAxisAlignment: MainAxisAlignment.center,\r\n                            children: [\r\n                              Text(\r\n                                \"${formatter.format(widget.classifield.price)}  ₺\",\r\n                                style: TextStyle(\r\n                                  color: Colors.grey.shade800,\r\n                                  fontSize: 18,\r\n                                  fontWeight: FontWeight.w600,\r\n                                ),\r\n                                textAlign: TextAlign.center,\r\n                              ),\r\n                            ],\r\n                          ),\r\n                        ),\r\n                      ),\r\n                      SizedBox(\r\n                        width: 10,\r\n                      ),\r\n                      Expanded(\r\n                        flex: 1,\r\n                        child: Material(\r\n                          borderRadius: BorderRadius.circular(5),\r\n                          color: isMine()\r\n                              ? Colors.deepPurpleAccent.withOpacity(.1)\r\n                              : Color(0xff25D366).withOpacity(.1),\r\n                          child: InkWell(\r\n                            borderRadius: BorderRadius.circular(5),\r\n                            onTap: () async {\r\n                              if (isMine()) {\r\n                                Navigator.of(context).push(MaterialPageRoute(\r\n                                    builder: (_) => CreateClassifiedScreen(\r\n                                        classifiedId: widget.classifield.id)));\r\n\r\n                                return;\r\n                              } else {\r\n                                launchWhatsapp();\r\n                              }\r\n                            },\r\n                            child: Container(\r\n                                padding: EdgeInsets.symmetric(\r\n                                    horizontal: 5, vertical: 14),\r\n                                child: Center(\r\n                                    child: Icon(\r\n                                  isMine()\r\n                                      ? FontAwesomeIcons.edit\r\n                                      : FontAwesomeIcons.whatsapp,\r\n                                  color: isMine()\r\n                                      ? Colors.deepPurple\r\n                                      : Color(0xff25D366),\r\n                                  size: 28,\r\n                                ))),\r\n                          ),\r\n                        ),\r\n                      ),\r\n                      SizedBox(\r\n                        width: 10,\r\n                      ),\r\n                      Expanded(\r\n                        flex: 1,\r\n                        child: Material(\r\n                          borderRadius: BorderRadius.circular(5),\r\n                          color: Colors.redAccent.withOpacity(.1),\r\n                          child: InkWell(\r\n                            borderRadius: BorderRadius.circular(5),\r\n                            onTap: () async {\r\n                              if (widget.classifield.classifiedStatus == 0) {\r\n                                ScaffoldMessenger.of(context).showSnackBar(SnackBar(\r\n                                    content: Text(\r\n                                        \"İlan henüz onaylanmadığı için paylaşamazsınız.\")));\r\n                                return;\r\n                              } else if (Provider.of<AuthProvider>(context,\r\n                                      listen: false)\r\n                                  .isLoggedIn()) {\r\n                                final affiliateId =\r\n                                    await Provider.of<ClassifiedProvider>(\r\n                                            context,\r\n                                            listen: false)\r\n                                        .generateAffiliateLink(\r\n                                            widget.classifield.id);\r\n                                Clipboard.setData(ClipboardData(\r\n                                        text:\r\n                                            'https://emlakcarsim.com/ilan/$affiliateId'))\r\n                                    .then((_) {\r\n                                  ScaffoldMessenger.of(context).showSnackBar(\r\n                                      SnackBar(\r\n                                          content: Text(\r\n                                              \"İlan paylaşım linkiniz kopyalandı.\")));\r\n                                });\r\n\r\n                                FlutterShare.share(\r\n                                    title: 'İlanı Paylaş',\r\n                                    linkUrl:\r\n                                        'https://emlakcarsim.com/ilan/$affiliateId');\r\n                              } else {\r\n                                ScaffoldMessenger.of(context)\r\n                                    .showSnackBar(SnackBar(\r\n                                  content: Text(\r\n                                      'İlanı paylaşabilmek için giriş yapmalısınız.'),\r\n                                ));\r\n                              }\r\n                            },\r\n                            child: Container(\r\n                                padding: EdgeInsets.symmetric(\r\n                                    horizontal: 5, vertical: 3),\r\n                                child: Center(\r\n                                    child: FaIcon(\r\n                                  FontAwesomeIcons.shareAlt,\r\n                                  color: Colors.redAccent,\r\n                                  size: 28,\r\n                                ))),\r\n                          ),\r\n                        ),\r\n                      ),\r\n                      SizedBox(\r\n                        width: 10,\r\n                      ),\r\n                      Expanded(\r\n                        flex: 1,\r\n                        child: Material(\r\n                          borderRadius: BorderRadius.circular(5),\r\n                          color: Colors.yellow.withOpacity(.3),\r\n                          child: InkWell(\r\n                            borderRadius: BorderRadius.circular(5),\r\n                            onTap: () async {\r\n                              if (Provider.of<AuthProvider>(context,\r\n                                      listen: false)\r\n                                  .isLoggedIn()) {\r\n                                final status = await Provider.of<\r\n                                            ClassifiedProvider>(context,\r\n                                        listen: false)\r\n                                    .favouriteClassified(widget.classifield.id);\r\n\r\n                                setState(() {\r\n                                  isFaved = status;\r\n                                });\r\n                              } else {\r\n                                Navigator.of(context).push(MaterialPageRoute(\r\n                                    builder: (_) => LoginScreen()));\r\n                              }\r\n                            },\r\n                            child: Container(\r\n                                padding: EdgeInsets.symmetric(\r\n                                    horizontal: 5, vertical: 3),\r\n                                child: Center(\r\n                                    child: FaIcon(\r\n                                  isFaved\r\n                                      ? FontAwesomeIcons.solidStar\r\n                                      : FontAwesomeIcons.star,\r\n                                  color: Colors.orangeAccent,\r\n                                  size: 28,\r\n                                ))),\r\n                          ),\r\n                        ),\r\n                      ),\r\n                    ],\r\n                  ),\r\n                ),\r\n                // SizedBox(\r\n                //   height: 20,\r\n                // ),\r\n                // CustomSecondaryButton(\r\n                //   text: 'Satıldı Olarak İşaretle',\r\n                //   color: Config.PrimaryColor,\r\n                //   textColor: Colors.white,\r\n                //   isLoading: false,\r\n                //   onPress: () {},\r\n                // ),\r\n                SizedBox(\r\n                  height: 30,\r\n                ),\r\n                InfoRow(\r\n                  title: 'Fiyat',\r\n                  value: '${widget.classifield.price} TL',\r\n                  valueColor: Config.PrimaryColor,\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'İlan Tarihi',\r\n                  value:\r\n                      '${DateFormat(\"dd-MM-yyyy\").format(DateTime.parse(widget.classifield.createdAt))}',\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'İl',\r\n                  value: '${widget.classifield.city}',\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'İlçe',\r\n                  value: '${widget.classifield.district}',\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'Mahalle',\r\n                  value: '${widget.classifield.neighborhood}',\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'Kategori',\r\n                  value: '${widget.classifield.category ?? ''}',\r\n                ),\r\n                Divider(\r\n                  color: Colors.grey.shade300,\r\n                ),\r\n                InfoRow(\r\n                  title: 'Kullanım Durumu',\r\n                  value: widget.classifield.usageStatusId != null\r\n                      ? usageStatus.firstWhere(\r\n                          (k) => k['value'] == widget.classifield.usageStatusId,\r\n                          orElse: () => 0)['title']\r\n                      : 'Girilmemiş',\r\n                ),\r\n                SizedBox(\r\n                  height: 40,\r\n                ),\r\n                Column(\r\n                  crossAxisAlignment: CrossAxisAlignment.start,\r\n                  children: [\r\n                    SizedBox(\r\n                      height: 0,\r\n                    ),\r\n                    // Text(\r\n                    //   \"Açıklama\",\r\n                    //   style: TextStyle(\r\n                    //     fontSize: 16,\r\n                    //     fontWeight: FontWeight.w700,\r\n                    //     color: Colors.grey.shade800,\r\n                    //   ),\r\n                    //   textAlign: TextAlign.start,\r\n                    // ),\r\n                    Container(\r\n                      margin: EdgeInsets.only(bottom: 20),\r\n                      child: Text(\r\n                        widget.classifield.description,\r\n                        style: TextStyle(\r\n                            fontSize: 15,\r\n                            color: Colors.grey.shade700,\r\n                            fontWeight: FontWeight.w300),\r\n                        textAlign: TextAlign.start,\r\n                      ),\r\n                    )\r\n                  ],\r\n                )\r\n              ],\r\n            ),\r\n          );\r\n        },\r\n      )),\r\n    );\r\n  }\r\n\r\n  bool isMine() {\r\n    if (Provider.of<AuthProvider>(context, listen: false).isLoggedIn() &&\r\n        widget.classifield.user != null &&\r\n        Provider.of<ProfileProvider>(context, listen: false).userInfoModel !=\r\n            null &&\r\n        widget.classifield.user.id ==\r\n            Provider.of<ProfileProvider>(context, listen: false)\r\n                .userInfoModel\r\n                .id) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  launchWhatsapp() async {\r\n    String whatsApp = Provider.of<SplashProvider>(context, listen: false)\r\n        .configModel\r\n        .whatsappPhone;\r\n\r\n    String message =\r\n        'Merhaba \"${widget.classifield.title}\" ilanı için sizinle iletişime geçiyorum.';\r\n\r\n    launch('whatsapp://send?phone=$whatsApp&text=$message');\r\n  }\r\n}\r\n\r\nclass InfoRow extends StatelessWidget {\r\n  InfoRow(\r\n      {this.title,\r\n      this.value,\r\n      this.valueColor = Colors.black87,\r\n      this.valueFontWeight = FontWeight.w500});\r\n\r\n  String title;\r\n  String value;\r\n  Color valueColor;\r\n  FontWeight valueFontWeight;\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Row(\r\n      mainAxisSize: MainAxisSize.max,\r\n      mainAxisAlignment: MainAxisAlignment.spaceBetween,\r\n      children: [\r\n        Expanded(\r\n          child: Text(\r\n            title,\r\n            style: TextStyle(color: Colors.black54),\r\n          ),\r\n        ),\r\n        Expanded(\r\n          child: Text(\r\n            value,\r\n            textAlign: TextAlign.end,\r\n            style: TextStyle(fontWeight: valueFontWeight, color: valueColor),\r\n          ),\r\n        )\r\n      ],\r\n    );\r\n  }\r\n}\r\n"
        }
    ]
}